<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Du Lá»‹ch ÄÃª!</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ—ºï¸</text></svg>">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    #map {
      height: 600px;
      width: 100%;
      border-radius: 16px;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.8);
    }
    
    .poi-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border: 2px solid transparent;
    }
    
    .poi-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 12px 24px -4px rgba(0, 0, 0, 0.2);
      border-color: #3b82f6;
    }
    
    .quick-search {
      transition: all 0.2s ease;
      border: 2px solid transparent;
    }
    
    .quick-search:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
      border-color: #3b82f6;
    }
    
    .quick-search:active {
      transform: scale(0.95);
    }
    
    .loading-spinner {
      border: 4px solid #e5e7eb;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .marker-icon {
      background-color: #3b82f6;
      border: 3px solid white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .search-input-wrapper {
      position: relative;
    }
    
    .search-input-wrapper::before {
      content: 'ğŸ”';
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      pointer-events: none;
      z-index: 10;
    }
    
    #locationInput {
      padding-left: 48px !important;
    }
    
    .feature-badge {
      display: inline-block;
      padding: 4px 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
      box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">
        ğŸ—ºï¸ KhÃ¡m PhÃ¡ Viá»‡t Nam
      </h1>
      <p class="text-lg text-gray-600 mb-3">TÃ¬m kiáº¿m Ä‘iá»ƒm du lá»‹ch vÃ  khÃ¡m phÃ¡ cÃ¡c Ä‘á»‹a Ä‘iá»ƒm thÃº vá»‹ gáº§n Ä‘Ã³</p>
      <div class="flex justify-center gap-2 flex-wrap">
        <span class="feature-badge">ğŸ¯ TÃ¬m kiáº¿m nhanh</span>
        <span class="feature-badge">ğŸ“ 5 Ä‘iá»ƒm thÃº vá»‹</span>
        <span class="feature-badge">ğŸ—¨ï¸ Miá»…n phÃ­ 100%</span>
      </div>
    </div>

    <!-- Search Section -->
    <div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border border-gray-100">
      <div class="flex gap-4 flex-col sm:flex-row">
        <div class="flex-1">
          <label class="block text-sm font-bold text-gray-800 mb-3 flex items-center gap-2">
            <span>ğŸ“Œ</span>
            <span>Nháº­p tÃªn Ä‘á»‹a Ä‘iá»ƒm á»Ÿ Viá»‡t Nam:</span>
          </label>
          <div class="search-input-wrapper">
            <input 
              type="text" 
              id="locationInput" 
              placeholder="VÃ­ dá»¥: HÃ  Ná»™i, ÄÃ  Náºµng, Há»™i An, Nha Trang..."
              class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all text-lg"
              autocomplete="off"
            />
          </div>
        </div>
        <div class="flex items-end">
          <button 
            id="searchBtn" 
            class="w-full sm:w-auto px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold rounded-xl hover:from-blue-700 hover:to-blue-800 active:scale-95 transition-all shadow-lg hover:shadow-xl"
          >
            ğŸ” TÃ¬m kiáº¿m
          </button>
        </div>
      </div>
      
      <!-- Loading indicator -->
      <div id="loading" class="hidden mt-6 flex items-center justify-center p-6 bg-blue-50 rounded-xl">
        <div class="loading-spinner"></div>
        <span class="ml-4 text-blue-700 font-semibold text-lg">Äang tÃ¬m kiáº¿m Ä‘iá»ƒm thÃº vá»‹...</span>
      </div>
      
      <!-- Error message -->
      <div id="errorMsg" class="hidden mt-6 p-5 bg-red-50 border-2 border-red-300 text-red-800 rounded-xl font-medium"></div>
      
      <!-- Quick search buttons -->
      <div class="mt-6">
        <p class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
          <span>âš¡</span>
          <span>Hoáº·c chá»n Ä‘á»‹a Ä‘iá»ƒm phá»• biáº¿n:</span>
        </p>
        <div class="flex flex-wrap gap-3">
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="HÃ  Ná»™i">
            ğŸ“ HÃ  Ná»™i
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="Há»™i An">
            ğŸ® Há»™i An
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="ÄÃ  Náºµng">
            ğŸŒŠ ÄÃ  Náºµng
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="Nha Trang">
            ğŸ–ï¸ Nha Trang
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="SÃ i GÃ²n">
            ğŸ™ï¸ SÃ i GÃ²n
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="PhÃº Quá»‘c">
            ğŸï¸ PhÃº Quá»‘c
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="Huáº¿">
            ğŸ‘‘ Huáº¿
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="ÄÃ  Láº¡t">
            ğŸŒ¹ ÄÃ  Láº¡t
          </button>
          <button class="quick-search px-5 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 rounded-full text-sm font-semibold shadow-sm" data-location="SÃ³c TrÄƒng">
            ğŸŒ¾ SÃ³c TrÄƒng
          </button>
        </div>
      </div>
    </div>

    <!-- Points of Interest Section (moved before map) -->
    <div id="poiSection" class="hidden">
      <div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border border-gray-100">
        <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <span class="text-4xl">ğŸ“</span>
          <span>5 Äiá»ƒm ThÃº Vá»‹ Gáº§n ÄÃ³</span>
        </h2>
        <div id="poiList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"></div>
      </div>
    </div>

    <!-- Map Section -->
    <div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border border-gray-100">
      <h2 class="text-3xl font-bold text-gray-800 mb-5 flex items-center gap-3">
        <span class="text-4xl">ğŸ—ºï¸</span>
        <span>Báº£n Ä‘á»“</span>
      </h2>
      <div id="map"></div>
      <p class="text-xs text-gray-500 mt-3 text-center">
        ğŸ’¡ <strong>Máº¹o:</strong> Click vÃ o marker trÃªn báº£n Ä‘á»“ hoáº·c tháº» bÃªn trÃªn Ä‘á»ƒ xem chi tiáº¿t
      </p>
    </div>
    
    <!-- Debug Info (toggle with Ctrl+Shift+D) -->
    <div id="debugPanel" class="hidden fixed bottom-4 right-4 bg-gray-900 text-white p-4 rounded-lg shadow-2xl max-w-md text-xs font-mono">
      <div class="flex justify-between items-center mb-2">
        <span class="font-bold">ğŸ” Debug Info</span>
        <button onclick="document.getElementById('debugPanel').classList.add('hidden')" class="text-gray-400 hover:text-white">âœ•</button>
      </div>
      <div id="debugContent"></div>
    </div>
  </div>

  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script>
    // Initialize map centered on Vietnam
    let map = L.map('map').setView([16.0544, 108.2022], 6);
    
    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);
    
    let markers = [];
    let currentLocation = null;
    let searchCache = new Map(); // Cache for search results
    
    // Get DOM elements
    const searchBtn = document.getElementById('searchBtn');
    const locationInput = document.getElementById('locationInput');
    const loading = document.getElementById('loading');
    const errorMsg = document.getElementById('errorMsg');
    const poiSection = document.getElementById('poiSection');
    const poiList = document.getElementById('poiList');
    
    // Search function
    async function searchLocation() {
      const query = locationInput.value.trim();
      
      if (!query) {
        showError('Vui lÃ²ng nháº­p tÃªn Ä‘á»‹a Ä‘iá»ƒm!');
        return;
      }
      
      // Clear previous results
      clearMarkers();
      hideError();
      poiSection.classList.add('hidden');
      loading.classList.remove('hidden');
      
      try {
        // Check cache first
        const cacheKey = query.toLowerCase();
        if (searchCache.has(cacheKey)) {
          console.log('Using cached results for:', query);
          const cached = searchCache.get(cacheKey);
          currentLocation = cached.location;
          map.setView([currentLocation.lat, currentLocation.lon], 14);
          
          const mainMarker = L.marker([currentLocation.lat, currentLocation.lon], {
            icon: L.divIcon({
              className: 'custom-marker',
              html: `<div style="background-color: #ef4444; border: 3px solid white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3); font-size: 20px;">ğŸ“</div>`,
              iconSize: [40, 40],
              iconAnchor: [20, 40]
            })
          }).addTo(map);
          
          mainMarker.bindPopup(`<b>${query}</b><br>${currentLocation.name}`).openPopup();
          markers.push(mainMarker);
          
          displayPOIs(cached.pois);
          loading.classList.add('hidden');
          return;
        }
        
        // Step 1: Geocode the location using Nominatim
        const geocodeUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query + ', Vietnam')}&format=json&limit=1&addressdetails=1`;
        const geocodeResponse = await fetch(geocodeUrl, {
          headers: {
            'User-Agent': 'VietnamPOIFinder/1.0'
          }
        });
        const geocodeData = await geocodeResponse.json();
        
        if (geocodeData.length === 0) {
          throw new Error('KhÃ´ng tÃ¬m tháº¥y Ä‘á»‹a Ä‘iá»ƒm. Vui lÃ²ng thá»­ láº¡i vá»›i tÃªn khÃ¡c.');
        }
        
        const location = geocodeData[0];
        currentLocation = {
          lat: parseFloat(location.lat),
          lon: parseFloat(location.lon),
          name: location.display_name
        };
        
        // Center map on location
        map.setView([currentLocation.lat, currentLocation.lon], 14);
        
        // Add main location marker
        const mainMarker = L.marker([currentLocation.lat, currentLocation.lon], {
          icon: L.divIcon({
            className: 'custom-marker',
            html: `<div style="background-color: #ef4444; border: 3px solid white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3); font-size: 20px;">ğŸ“</div>`,
            iconSize: [40, 40],
            iconAnchor: [20, 40]
          })
        }).addTo(map);
        
        mainMarker.bindPopup(`<b>${query}</b><br>${currentLocation.name}`).openPopup();
        markers.push(mainMarker);
        
        // Step 2: Find points of interest using Overpass API
        await findPointsOfInterest(currentLocation.lat, currentLocation.lon);
        
      } catch (error) {
        showError(error.message);
      } finally {
        loading.classList.add('hidden');
      }
    }
    
    // Find points of interest using Overpass API
    async function findPointsOfInterest(lat, lon) {
      try {
        console.log('Searching for POIs near:', lat, lon);
        
        // Simplified query - search for ANY named place within radius
        const radius = 3000; // 3km radius
        const overpassQuery = `
          [out:json][timeout:25];
          (
            node["name"](around:${radius},${lat},${lon});
            way["name"](around:${radius},${lat},${lon});
          );
          out body 50;
          >;
          out skel qt;
        `;
        
        const overpassUrl = 'https://overpass-api.de/api/interpreter';
        const response = await fetch(overpassUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: 'data=' + encodeURIComponent(overpassQuery)
        });
        
        // Check if response is OK
        if (!response.ok) {
          throw new Error(`Overpass API error: ${response.status} ${response.statusText}`);
        }
        
        // Check content type to ensure we get JSON
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          console.error('Non-JSON response:', text.substring(0, 200));
          throw new Error('Overpass API tráº£ vá» lá»—i. Vui lÃ²ng thá»­ láº¡i sau Ã­t phÃºt.');
        }
        
        const data = await response.json();
        
        console.log('Overpass API returned:', data.elements ? data.elements.length : 0, 'results');
        
        if (!data.elements || data.elements.length === 0) {
          // Fallback: Try a simpler query with larger radius
          console.log('No POIs found from Overpass, trying fallback...');
          await findPOIsFallback(lat, lon);
          return;
        }
        
        // Process and display POIs
        const pois = processPOIs(data.elements);
        displayPOIs(pois);
        
      } catch (error) {
        console.error('POI search error:', error);
        // Try fallback method
        try {
          console.log('Trying fallback POI search...');
          await findPOIsFallback(lat, lon);
        } catch (fallbackError) {
          showError('Lá»—i khi tÃ¬m kiáº¿m Ä‘iá»ƒm thÃº vá»‹: ' + error.message);
        }
      }
    }
    
    // Fallback method using Nominatim nearby search
    async function findPOIsFallback(lat, lon) {
      try {
        console.log('Using fallback method with Nominatim...');
        
        // Always show the main location first
        const defaultPOIs = [
          {
            name: currentLocation.name.split(',')[0] || 'Äá»‹a Ä‘iá»ƒm chÃ­nh',
            type: 'Vá»‹ trÃ­ tÃ¬m kiáº¿m',
            lat: lat,
            lon: lon,
            icon: 'ğŸ“',
            description: 'Vá»‹ trÃ­ trung tÃ¢m báº¡n Ä‘Ã£ tÃ¬m kiáº¿m',
            address: currentLocation.name
          }
        ];
        
        // Search nearby in multiple categories
        const categories = ['restaurant', 'cafe', 'museum', 'park', 'hotel', 'shop'];
        
        for (const category of categories) {
          if (defaultPOIs.length >= 5) break;
          
          try {
            const searchUrl = `https://nominatim.openstreetmap.org/search?q=${category}+near+${lat},${lon}&format=json&limit=3`;
            await new Promise(resolve => setTimeout(resolve, 500)); // Rate limit
            
            const response = await fetch(searchUrl, {
              headers: { 'User-Agent': 'VietnamPOIFinder/1.0' }
            });
            const places = await response.json();
            
            for (const place of places) {
              if (defaultPOIs.length >= 5) break;
              if (place.lat && place.lon && place.display_name) {
                const name = place.display_name.split(',')[0];
                // Avoid duplicates
                if (!defaultPOIs.some(p => p.name === name)) {
                  defaultPOIs.push({
                    name: name,
                    type: category.charAt(0).toUpperCase() + category.slice(1),
                    lat: parseFloat(place.lat),
                    lon: parseFloat(place.lon),
                    icon: getIconForCategory(category),
                    description: place.display_name,
                    address: place.display_name
                  });
                }
              }
            }
          } catch (err) {
            console.warn('Search failed for category:', category, err);
          }
        }
        
        console.log('Fallback found', defaultPOIs.length, 'POIs');
        displayPOIs(defaultPOIs);
        
      } catch (error) {
        console.error('Fallback error:', error);
        // Show at least the main location
        displayPOIs([{
          name: currentLocation.name.split(',')[0] || 'Äá»‹a Ä‘iá»ƒm',
          type: 'Vá»‹ trÃ­ tÃ¬m kiáº¿m',
          lat: lat,
          lon: lon,
          icon: 'ğŸ“',
          description: 'Vá»‹ trÃ­ báº¡n Ä‘Ã£ tÃ¬m kiáº¿m. Dá»¯ liá»‡u POI cÃ³ thá»ƒ khÃ´ng Ä‘áº§y Ä‘á»§ cho khu vá»±c nÃ y.',
          address: currentLocation.name
        }]);
      }
    }
    
    // Helper function to get icon based on category
    function getIconForCategory(category) {
      const iconMap = {
        'restaurant': 'ğŸ½ï¸',
        'cafe': 'â˜•',
        'museum': 'ğŸ›ï¸',
        'park': 'ğŸŒ³',
        'hotel': 'ğŸ¨',
        'shop': 'ğŸ›ï¸',
        'tourism': 'ğŸ¯',
        'amenity': 'ğŸ“',
        'historic': 'ğŸ›ï¸',
        'leisure': 'ğŸ®'
      };
      return iconMap[category] || 'ğŸ“';
    }
    
    // Process POI data
    function processPOIs(elements) {
      const pois = [];
      const seenNames = new Set();
      
      // Filter elements to only those with names and valid tags
      const validElements = elements.filter(el => {
        const tags = el.tags || {};
        return tags.name && (tags.tourism || tags.amenity || tags.historic || tags.leisure || tags.shop || tags.building);
      });
      
      console.log('Valid named elements:', validElements.length);
      
      for (const element of validElements) {
        if (pois.length >= 5) break;
        
        let lat, lon;
        
        if (element.type === 'node') {
          lat = element.lat;
          lon = element.lon;
        } else if (element.type === 'way' && element.center) {
          lat = element.center.lat;
          lon = element.center.lon;
        } else if (element.type === 'way' && element.bounds) {
          // Calculate center from bounds
          lat = (element.bounds.minlat + element.bounds.maxlat) / 2;
          lon = (element.bounds.minlon + element.bounds.maxlon) / 2;
        } else {
          continue;
        }
        
        const tags = element.tags || {};
        const name = tags.name || tags['name:vi'] || tags['name:en'] || 'KhÃ´ng cÃ³ tÃªn';
        
        // Skip unnamed or duplicate entries
        if (name === 'KhÃ´ng cÃ³ tÃªn' || seenNames.has(name)) continue;
        seenNames.add(name);
        
        // Determine type
        let type = tags.tourism || tags.amenity || tags.historic || tags.leisure || tags.shop || tags.building || 'Äá»‹a Ä‘iá»ƒm';
        type = type.charAt(0).toUpperCase() + type.slice(1).replace(/_/g, ' ');
        
        // Get icon
        const icon = getIconForType(tags);
        
        pois.push({
          name,
          type,
          lat,
          lon,
          icon,
          description: tags.description || tags['addr:full'] || `${type} táº¡i ${currentLocation.name.split(',')[0]}`,
          address: tags['addr:street'] || tags['addr:city'] || ''
        });
      }
      
      console.log('Processed POIs:', pois.length);
      return pois;
    }
    
    // Get icon based on POI type
    function getIconForType(tags) {
      if (tags.tourism) {
        if (tags.tourism === 'hotel') return 'ğŸ¨';
        if (tags.tourism === 'museum') return 'ğŸ›ï¸';
        if (tags.tourism === 'attraction') return 'â­';
        if (tags.tourism === 'viewpoint') return 'ğŸ‘ï¸';
        if (tags.tourism === 'information') return 'â„¹ï¸';
        if (tags.tourism === 'gallery') return 'ğŸ–¼ï¸';
        return 'ğŸ¯';
      }
      if (tags.amenity) {
        if (tags.amenity === 'restaurant') return 'ğŸ½ï¸';
        if (tags.amenity === 'cafe') return 'â˜•';
        if (tags.amenity === 'museum') return 'ğŸ›ï¸';
        if (tags.amenity === 'theatre') return 'ğŸ­';
        if (tags.amenity === 'cinema') return 'ğŸ¬';
        if (tags.amenity === 'park') return 'ğŸŒ³';
        if (tags.amenity === 'attraction') return 'â­';
        return 'ğŸ“';
      }
      if (tags.historic) {
        if (tags.historic === 'monument') return 'ğŸ—¿';
        if (tags.historic === 'castle') return 'ğŸ°';
        if (tags.historic === 'memorial') return 'âš”ï¸';
        return 'ğŸ›ï¸';
      }
      if (tags.leisure) {
        if (tags.leisure === 'park') return 'ğŸŒ³';
        if (tags.leisure === 'garden') return 'ğŸŒº';
        if (tags.leisure === 'beach_resort') return 'ğŸ–ï¸';
        return 'ğŸ®';
      }
      return 'ğŸ“';
    }
    
    // Display POIs on map and list
    function displayPOIs(pois) {
      poiList.innerHTML = '';
      
      if (pois.length === 0) {
        showError('KhÃ´ng tÃ¬m tháº¥y Ä‘iá»ƒm thÃº vá»‹ nÃ o. Thá»­ Ä‘á»‹a Ä‘iá»ƒm khÃ¡c!');
        return;
      }
      
      poiSection.classList.remove('hidden');
      
      pois.forEach((poi, index) => {
        // Add marker to map
        const marker = L.marker([poi.lat, poi.lon], {
          icon: L.divIcon({
            className: 'custom-marker',
            html: `<div class="marker-icon">${index + 1}</div>`,
            iconSize: [30, 30],
            iconAnchor: [15, 30]
          })
        }).addTo(map);
        
        marker.bindPopup(`
          <div class="p-2">
            <div class="text-lg font-bold">${poi.icon} ${poi.name}</div>
            <div class="text-sm text-gray-600">${poi.type}</div>
            <div class="text-xs text-gray-500 mt-1">${poi.description}</div>
          </div>
        `);
        
        markers.push(marker);
        
        // Add to list
        const card = document.createElement('div');
        card.className = 'poi-card bg-gradient-to-br from-white to-gray-50 border-2 border-gray-200 rounded-xl p-5 cursor-pointer hover:shadow-xl';
        card.innerHTML = `
          <div class="flex items-start gap-4">
            <div class="text-4xl flex-shrink-0">${poi.icon}</div>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-gray-900 text-lg mb-1 truncate">${index + 1}. ${poi.name}</div>
              <div class="inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full mb-2">${poi.type}</div>
              <div class="text-sm text-gray-600 line-clamp-2">${poi.description}</div>
            </div>
          </div>
          <div class="mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500 flex items-center gap-1">
            <span>ğŸ‘†</span>
            <span>Click Ä‘á»ƒ xem trÃªn báº£n Ä‘á»“</span>
          </div>
        `;
        
        card.addEventListener('click', () => {
          map.setView([poi.lat, poi.lon], 16);
          marker.openPopup();
        });
        
        poiList.appendChild(card);
      });
      
        // Fit map bounds to show all markers
      if (markers.length > 0) {
        const group = new L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
      }
      
      // Cache the results
      if (currentLocation && locationInput.value.trim()) {
        searchCache.set(locationInput.value.trim().toLowerCase(), {
          location: currentLocation,
          pois: pois
        });
      }
    }    // Clear all markers
    function clearMarkers() {
      markers.forEach(marker => map.removeLayer(marker));
      markers = [];
    }
    
    // Show error message
    function showError(message) {
      errorMsg.textContent = message;
      errorMsg.classList.remove('hidden');
    }
    
    // Hide error message
    function hideError() {
      errorMsg.classList.add('hidden');
    }
    
    // Event listeners
    searchBtn.addEventListener('click', searchLocation);
    
    locationInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchLocation();
      }
    });
    
    // Quick search buttons
    document.querySelectorAll('.quick-search').forEach(btn => {
      btn.addEventListener('click', () => {
        locationInput.value = btn.dataset.location;
        searchLocation();
      });
    });
    
    // Debug panel toggle
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        const panel = document.getElementById('debugPanel');
        panel.classList.toggle('hidden');
      }
    });
    
    // Override console.log to show in debug panel
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      const debugContent = document.getElementById('debugContent');
      if (debugContent) {
        const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
        debugContent.innerHTML += `<div class="border-t border-gray-700 pt-1 mt-1">${msg}</div>`;
        debugContent.scrollTop = debugContent.scrollHeight;
      }
    };
    
    // Example searches (optional demo)
    console.log('VÃ­ dá»¥ Ä‘á»‹a Ä‘iá»ƒm báº¡n cÃ³ thá»ƒ tÃ¬m:');
    console.log('- HÃ  Ná»™i');
    console.log('- Há»™i An');
    console.log('- ÄÃ  Náºµng');
    console.log('- Nha Trang');
    console.log('- Phá»‘ cá»• HÃ  Ná»™i');
  </script>
</body>
</html>
